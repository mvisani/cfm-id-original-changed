# README #

### What is CFM-ID ###
CFM-ID provides a method for accurately and efficiently identifying metabolites in spectra generated by electrospray tandem mass spectrometry (ESI-MS/MS). The program uses Competitive Fragmentation Modeling to produce a probabilistic generative model for the MS/MS fragmentation process and machine learning techniques to adapt the model parameters from data.

#### CFM-ID can be used for: ####
* Predicting the spectra for a given chemical structure. This task predicts low/10V, medium/20V, and high/40V energy ESI-MS/MS spectra for an input structure provided in SMILES or InChI format. 
* Peak Assignment: Annotating the peaks in set of spectra given a known chemical structure. This task takes a set of three input spectra (for ESI spectra, low/10V, medium/20V, and high/40V energy levels) in peak list format and a chemical structure in SMILES or InChI format, then assigns a putative fragment annotation to the peaks in each spectrum. 
* Compound Identification:	Predicted ranking of possible candidate structures for a target spectrum. This task takes a set of three input spectra (for ESI spectra, low/10V, medium/20V, and high/40V energy levels) in peak list format, and ranks a list of candidate structures according to how well they match the input spectra. This candidate list need to be provided by the user. Chemical classes are predicted for each candidate molecule. The original similarity score used in the ranking was computed (Dice or DotProduct) by comparing the predicted spectra of a candidate compound with the input spectra. 
* A web service can be found at (http://cfmid4.wishartlab.com/)

### What is this repository for? ###
* This is a repository for CFM-ID 4 MSML (mass spectrum machine learning)
* CFM-ID MSRB (mass spectrum rule based) can be found at (https://bitbucket.org/wishartlab/msrb-fragmenter/src/master/)
* Original source code from CFM-ID 2.0 Can be found at (https://sourceforge.net/p/cfm-id/wiki/Home/)

### How do I get set up? ###
#### Used Docker ####
* Working in progress
#### Install from source code ####
* Please check INSTALL FILE
* Note Only Insatll on linux and Mac has been verified, while install on Windows from source code is possible 

#### Running cfm-predict in a docker container ####
==Running cfm-predict in Docker container directly==

Assuming your home directory is ```/home/ubuntu/```,
``` sudo docker run --rm=true -v /home/ubuntu/cfm_id/cfmid/output:/root -i cfmid:latest sh -c "cd /root/; cfm-predict 'CC(C)NCC(O)COC1=CC=C(CCOCC2CC2)C=C1' 0.001 /root/param_output0.log /root/param_config.txt 1 /root/positive/myout"```

#### Running cfm-predict in a Singularity container ####

Build or obtain your CFM-ID Docker image, and convert it to a Singularity image using instructions as given [[Compute_Canada_High-Performance_Computing#Converting_Docker_images_to_Singularity_images|here]].

Run the Singularity container from the SIF file:
``` singularity exec --bind output:/out cfmid_2.0.0.1.sif cfm-predict \''CC(C)NCC(O)COC1=CC=C(CCOCC2CC2)C=C1'\' 0.001 /out/param_output0.log /out/param_config.txt 1 /out/positive/myout.txt ```